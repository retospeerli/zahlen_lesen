<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Zahlenbilder 1â€“20 â€“ Multiple Choice</title>
  <style>
    :root{
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background:#eef2ff;
    }
    body{ margin:0; min-height:100vh; display:flex; align-items:center; justify-content:center; }
    .app{
      background:#fff; border-radius:18px; box-shadow:0 10px 30px rgba(0,0,0,.12);
      padding:2rem 2.3rem; max-width:820px; width:100%; box-sizing:border-box;
    }
    h1{ margin:0 0 .35rem; text-align:center; font-size:1.7rem; }
    .subtitle{ text-align:center; color:#4b5563; margin:0 0 1.1rem; font-size:.95rem; }
    .hidden{ display:none; }

    .row{ display:flex; justify-content:space-between; align-items:center; gap:.8rem; flex-wrap:wrap; }
    .badge{
      font-size:.85rem; color:#374151; background:#eef2ff; border:1px solid #c7d2fe;
      padding:.2rem .55rem; border-radius:999px;
    }

    .primary-btn{
      width:100%; padding:.75rem 1rem; border-radius:999px; border:none; cursor:pointer;
      background:#2563eb; color:#fff; font-weight:800; font-size:1.05rem;
    }
    .primary-btn:hover{ background:#1d4ed8; }
    .secondary-btn{
      width:100%; margin-top:.5rem; padding:.65rem 1rem; border-radius:999px; border:1px solid #d1d5db;
      cursor:pointer; background:#f9fafb; color:#111827; font-weight:700; font-size:1rem;
    }
    .secondary-btn:hover{ background:#e5e7eb; }

    .card{
      background:#f9fafb; border:1px solid #e5e7eb; border-radius:16px; padding:1rem;
    }

    label{ font-size:.9rem; color:#374151; font-weight:800; display:block; margin:.6rem 0 .25rem; }
    select{
      width:100%;
      padding:.65rem .75rem;
      border-radius:12px;
      border:2px solid #d1d5db;
      background:#fff;
      font-size:1rem;
      font-weight:700;
      color:#111827;
      outline:none;
    }
    select:focus{ border-color:#2563eb; box-shadow:0 0 0 4px rgba(37,99,235,.15); }

    .image-wrap{
      display:flex; justify-content:center; margin-top:1rem;
    }
    .img-card{
      width:min(420px, 100%);
      aspect-ratio: 1 / 1;
      border-radius:18px;
      background:#fff;
      border:2px solid #e5e7eb;
      box-shadow: inset 0 0 10px rgba(0,0,0,.05);
      display:flex; align-items:center; justify-content:center;
      overflow:hidden;
    }
    .img-card img{
      width:100%;
      height:100%;
      object-fit:contain;
      display:block;
      background:#fff;
    }

    .prompt{
      text-align:center; font-size:1.15rem; color:#111827; margin:1rem 0 .6rem;
      font-weight:900;
    }

    .options{
      display:grid;
      grid-template-columns:repeat(4, minmax(0, 1fr));
      gap:.7rem;
      margin-top:.8rem;
    }
    .opt{
      border-radius:16px;
      border:2px solid #d1d5db;
      background:#f9fafb;
      padding:.9rem .3rem;
      cursor:pointer;
      font-weight:900;
      font-size:1.25rem;
      transition: transform .05s ease, box-shadow .15s ease, border-color .15s ease, background .15s ease;
    }
    .opt:hover{ border-color:#9ca3af; box-shadow:0 8px 18px rgba(0,0,0,.08); background:#fff; }
    .opt:active{ transform:translateY(1px); }
    .opt:disabled{ cursor:not-allowed; opacity:.7; }

    .feedback{ min-height:1.3rem; text-align:center; font-weight:900; margin-top:.8rem; }
    .ok{ color:#15803d; }
    .err{ color:#b91c1c; }

    @media (max-width:560px){
      .options{ grid-template-columns:repeat(2, minmax(0,1fr)); }
    }
  </style>
</head>
<body>
<div class="app">
  <h1>Zahlenbilder 1â€“20</h1>
  <p class="subtitle">
    Schau das Bild an und klicke die richtige Zahl an.
  </p>

  <!-- START -->
  <div id="start-screen">
    <div class="card">
      <label for="questions-select">Anzahl Aufgaben</label>
      <select id="questions-select">
        <option value="10">10 Aufgaben</option>
        <option value="15">15 Aufgaben</option>
        <option value="20" selected>20 Aufgaben</option>
      </select>

      <label for="choices-select">AntwortmÃ¶glichkeiten pro Aufgabe</label>
      <select id="choices-select">
        <option value="4" selected>4 Buttons</option>
        <option value="6">6 Buttons</option>
        <option value="8">8 Buttons</option>
      </select>

      <p class="badge" style="margin:.8rem auto 0; display:inline-block;">
        Bilder im Repo: <strong>images/1.png</strong> â€¦ <strong>images/20.png</strong>
      </p>
      <p class="badge" style="margin:.35rem auto 0; display:inline-block;">
        Audio im Repo: <strong>audio/correct.wav</strong> &nbsp;|&nbsp; <strong>audio/error.wav</strong>
      </p>
    </div>

    <button class="primary-btn" id="start-btn" style="margin-top:1rem;">Los!</button>
  </div>

  <!-- QUIZ -->
  <div id="quiz-screen" class="hidden">
    <div class="row">
      <div class="badge" id="progress-badge">Aufgabe 1 / 20</div>
      <div class="row" style="gap:.5rem;">
        <span class="badge">Richtig: <span id="stat-correct">0</span></span>
        <span class="badge">Falsch: <span id="stat-wrong">0</span></span>
      </div>
    </div>

    <div class="image-wrap">
      <div class="img-card">
        <img id="number-img" alt="Zahlenbild" src="">
      </div>
    </div>

    <div class="prompt">Welche Zahl ist das?</div>

    <div class="options" id="options"></div>

    <div class="feedback" id="feedback"></div>
  </div>

  <!-- RESULT -->
  <div id="result-screen" class="hidden">
    <div class="card" style="text-align:center;">
      <h2 style="margin:.2rem 0 .2rem;">Fertig! ðŸŽ‰</h2>
      <p id="result-text" style="margin:.3rem 0 0; color:#374151; font-weight:700;"></p>
      <p style="margin:.8rem 0 0; font-size:.9rem; color:#4b5563;">
        Klicke auf <strong>â€žFertigâ€œ</strong>, damit LearningView den Auftrag als erledigt markiert.
      </p>
      <button class="primary-btn" id="finish-btn" style="margin-top:1rem;">Fertig</button>
      <button class="secondary-btn" id="again-btn">Nochmals Ã¼ben</button>
    </div>
  </div>
</div>

<!-- Audio -->
<audio id="sound-correct" src="audio/correct.wav" preload="auto"></audio>
<audio id="sound-error"   src="audio/error.wav"   preload="auto"></audio>

<script>
  // ========= Konfiguration =========
  const MIN_N = 1;
  const MAX_N = 20;
  const IMG_PATH = (n) => `images/${n}.png`;

  // ========= DOM =========
  const startScreen = document.getElementById("start-screen");
  const quizScreen = document.getElementById("quiz-screen");
  const resultScreen = document.getElementById("result-screen");

  const startBtn = document.getElementById("start-btn");
  const finishBtn = document.getElementById("finish-btn");
  const againBtn = document.getElementById("again-btn");

  const questionsSelect = document.getElementById("questions-select");
  const choicesSelect = document.getElementById("choices-select");

  const progressBadge = document.getElementById("progress-badge");
  const statCorrectEl = document.getElementById("stat-correct");
  const statWrongEl = document.getElementById("stat-wrong");
  const feedbackEl = document.getElementById("feedback");
  const optionsEl = document.getElementById("options");
  const imgEl = document.getElementById("number-img");
  const resultText = document.getElementById("result-text");

  // ========= Audio =========
  function playSound(id){
    const el = document.getElementById(id);
    if (!el) return;
    try{
      el.currentTime = 0;
      el.play().catch(()=>{});
    }catch(e){
      console.warn("Audio Fehler:", e);
    }
  }

  // ========= Utils =========
  function randInt(min, max){ return Math.floor(Math.random()*(max-min+1))+min; }
  function shuffle(arr){
    for(let i=arr.length-1;i>0;i--){
      const j = randInt(0,i);
      [arr[i], arr[j]] = [arr[j], arr[i]];
    }
    return arr;
  }

  function pickDistinctNumbers(count, correctN){
    const set = new Set([correctN]);
    while(set.size < count){
      set.add(randInt(MIN_N, MAX_N));
    }
    return shuffle([...set]);
  }

  // ========= Zustand =========
  let totalQuestions = 20;
  let choicesCount = 4;

  let order = [];      // zufÃ¤llige Reihenfolge der Bilder (Zahlen)
  let qIndex = 0;
  let correct = 0;
  let wrong = 0;
  let currentN = null;
  let locked = false;

  // ========= Preload (optional aber hilfreich) =========
  function preloadAllImages(){
    for(let n=MIN_N; n<=MAX_N; n++){
      const img = new Image();
      img.src = IMG_PATH(n);
    }
  }
  preloadAllImages();

  // ========= UI =========
  function setFeedback(text, ok){
    feedbackEl.textContent = text || "";
    feedbackEl.className = "feedback " + (ok ? "ok" : "err");
    if (!text) feedbackEl.className = "feedback";
  }

  function renderOptions(nums){
    optionsEl.innerHTML = "";
    nums.forEach(n => {
      const b = document.createElement("button");
      b.type = "button";
      b.className = "opt";
      b.textContent = String(n);
      b.addEventListener("click", () => choose(n));
      optionsEl.appendChild(b);
    });
  }

  function showQuestion(){
    locked = false;
    setFeedback("", true);

    progressBadge.textContent = `Aufgabe ${qIndex+1} / ${totalQuestions}`;
    currentN = order[qIndex];

    imgEl.src = IMG_PATH(currentN);
    imgEl.alt = `Zahlenbild ${currentN}`;

    // Wenn Bild fehlt: trotzdem nicht crashen (zeigt broken image)
    const nums = pickDistinctNumbers(choicesCount, currentN);
    renderOptions(nums);
  }

  function lockButtons(){
    optionsEl.querySelectorAll("button").forEach(b => b.disabled = true);
  }

  function choose(n){
    if (locked) return;
    locked = true;
    lockButtons();

    if (n === currentN){
      correct++;
      statCorrectEl.textContent = String(correct);
      setFeedback("Richtig! ðŸ‘", true);
      playSound("sound-correct");
    } else {
      wrong++;
      statWrongEl.textContent = String(wrong);
      setFeedback("Leider falsch.", false);
      playSound("sound-error");
    }

    qIndex++;
    if (qIndex >= totalQuestions){
      setTimeout(endQuiz, 700);
    } else {
      setTimeout(showQuestion, 700);
    }
  }

  function start(){
    totalQuestions = Number(questionsSelect.value) || 20;
    choicesCount = Number(choicesSelect.value) || 4;

    qIndex = 0;
    correct = 0;
    wrong = 0;
    statCorrectEl.textContent = "0";
    statWrongEl.textContent = "0";

    // zufÃ¤llige Reihenfolge ohne Wiederholung (max 20)
    const all = [];
    for(let n=MIN_N; n<=MAX_N; n++) all.push(n);
    shuffle(all);
    order = all.slice(0, Math.min(totalQuestions, all.length));

    // falls jemand >20 auswÃ¤hlen wÃ¼rde, fÃ¼llen wir durch erneutes Mischen nach:
    while(order.length < totalQuestions){
      shuffle(all);
      for(const n of all){
        if(order.length >= totalQuestions) break;
        order.push(n);
      }
    }

    startScreen.classList.add("hidden");
    resultScreen.classList.add("hidden");
    quizScreen.classList.remove("hidden");

    showQuestion();
  }

  function endQuiz(){
    quizScreen.classList.add("hidden");
    resultScreen.classList.remove("hidden");

    const pct = Math.round((correct / totalQuestions) * 100);
    resultText.innerHTML =
      `Du hast <strong>${totalQuestions}</strong> Aufgaben gelÃ¶st.<br>` +
      `Richtig: <strong>${correct}</strong> (${pct}%)<br>` +
      `Falsch: <strong>${wrong}</strong>.`;

    finishBtn.disabled = false;
    finishBtn.textContent = "Fertig";
  }

  // ========= Events =========
  startBtn.addEventListener("click", start);

  againBtn.addEventListener("click", () => {
    resultScreen.classList.add("hidden");
    startScreen.classList.remove("hidden");
  });

  // LearningView Feedback
  finishBtn.addEventListener("click", () => {
    finishBtn.disabled = true;
    finishBtn.textContent = "Erledigt âœ”";
    try{
      if (window.parent && window.parent !== window){
        window.parent.postMessage("AppSolved", "*");
      }
    }catch(e){
      console.warn("LearningView-AppSolved nicht mÃ¶glich:", e);
    }
  });
</script>
</body>
</html>
